<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: class/Loader.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: class/Loader.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const fs = require('fs/promises')
const path = require("path")
const { removeTrailingSlash } = require("../shared/removeTrailingSlash")

/**
 * The loader responsible for importing files from a directory.
 */
class Loader {
    constructor() {}

    /**
     * Entry point for importing files
     * 
     * @param {string} directory - The directory from which to import
     * @param {string} basePath - The URL path which imported routes will be put under
     * @returns {Array}
     */
    use = async function(directory, basePath) {
        let objs = await this.loadFromDir(directory, removeTrailingSlash(basePath))

        return objs
    }

    /**
     * Load files recursively from a specified directory
     * 
     * @param {string} dir - The directory
     * @param {string} basePath - The URL path which imported routes will be put under 
     * @returns {Array}
     */
    loadFromDir = async function(dir, basePath) {
        let current_exports = []
        let files = await fs.readdir(dir)

        for(let f of files) {
            // If our file is probably a javascript file
            if(f.endsWith(".js") || f.endsWith(".ts")) {
                let f_exports = require(path.join(dir, f))

                for(let exp in f_exports) {
                    let p = f_exports[exp]

                    // todo: instanceof does not work here for some reason, so we have to check by constructor name instead. need to see how to fix this later
                    if(p.constructor.name == "Route" || p.constructor.name == "Component") { 
                        current_exports.push(p)
                        if(p.constructor.name == "Route") { // Special cases for routes: we'll want to override the path and log it to the console.
                            p.path = ( basePath.split("/").concat(removeTrailingSlash(p.path).split("/")) ).join("/").replace("@", ":")
                            console.log(`\x1b[35morigami-loader: \x1b[32m${path.join(dir, f)} \x1b[35m-> \x1b[32m${p.method} ${p.path} \x1b[0m`) 
                        }
                    }
                }
            } else if(!f.split(".")[1]) { // If our file is likely a directory
                //todo: a bit faulty, would likely cause issues in cases of files with special names e.g. a file named "foo" would be treated as a dir
                current_exports = current_exports.concat(await this.loadFromDir(path.join(dir, f), basePath + "/" + f))
            }
        }

        return current_exports
    }
}

module.exports.Loader = Loader</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Component.html">Component</a></li><li><a href="ComponentStore.html">ComponentStore</a></li><li><a href="Loader.html">Loader</a></li><li><a href="Origami.html">Origami</a></li><li><a href="OrigamiMounter.html">OrigamiMounter</a></li><li><a href="OrigamiServer.html">OrigamiServer</a></li><li><a href="RequestContext.html">RequestContext</a></li><li><a href="RequestError.html">RequestError</a></li><li><a href="RequestHandler.html">RequestHandler</a></li><li><a href="RequestResponse.html">RequestResponse</a></li><li><a href="Route.html">Route</a></li><li><a href="RouteLeaf.html">RouteLeaf</a></li><li><a href="RouteStore.html">RouteStore</a></li></ul><h3>Global</h3><ul><li><a href="global.html#parsePathPart">parsePathPart</a></li><li><a href="global.html#removeTrailingSlash">removeTrailingSlash</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Mon Oct 09 2023 20:15:01 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
